(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-agent-booking-booking"],{"14c8":function(t,i,e){var a=e("ee2b");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var s=e("4f06").default;s("b48b4de4",a,!0,{sourceMap:!1,shadowMode:!1})},"91d5":function(t,i,e){"use strict";var a=e("14c8"),s=e.n(a);s.a},"96bf":function(t,i,e){"use strict";var a={uniNumberBox:e("22dc").default},s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("v-uni-view",{staticClass:"tobuy-container"},[t.isShow?e("v-uni-view",{staticClass:"login-dialog"},[e("v-uni-view",{staticClass:"login-dialog-cont"},[e("v-uni-view",{staticClass:"login-title"},[t._v("备注信息")]),e("v-uni-view",{staticClass:"login-list"},[e("v-uni-textarea",{staticClass:"f32",staticStyle:{height:"80px"},attrs:{placeholder:"请填写您的备注信息","placeholder-style":"color:#999"},model:{value:t.note,callback:function(i){t.note=i},expression:"note"}})],1),e("v-uni-scroll-view",{staticClass:"scroll-Y",attrs:{"scroll-y":"true","show-scrollbar":"true"}},[e("v-uni-view",t._l(t.priview,(function(i){return e("v-uni-view",{staticStyle:{"margin-bottom":"20rpx"}},["预定提醒"==i.name?e("v-uni-text",{staticClass:"stock-name",staticStyle:{"background-color":"#ff7f50"}},[t._v("缺货产生的预订单")]):e("v-uni-text",{staticClass:"stock-name",staticStyle:{"background-color":"#6dacf0"}},[t._v(t._s(i.name)+"进货单")]),e("v-uni-view",{staticClass:"detail-table"},[e("v-uni-view",{staticClass:"detail-tr no-ubb"},[e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"25%"}},[t._v("产品编号")]),e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"40%"}},[t._v("名称")]),e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"15%"}},[t._v("数量")]),e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"20%"}},[t._v("单价")])],1),t._l(i.list,(function(i){return e("v-uni-view",{staticClass:"detail-tr ub-ac"},[e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"25%"}},[t._v(t._s(i.erpcode))]),e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"40%"}},[t._v(t._s(i.name))]),e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"15%"}},[t._v(t._s(i.qty))]),e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"20%"}},[t._v(t._s(i.price))])],1)})),e("v-uni-view",{staticClass:"detail-tr",staticStyle:{"background-color":"#EEEEEE"}},[e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"50%"}},[t._v("合计："),e("v-uni-text",{staticClass:"am-blod"},[t._v(t._s(i.nums))])],1),e("v-uni-view",{staticClass:"detail-td",staticStyle:{width:"50%"}},[t._v("总金额："),e("v-uni-text",{staticClass:"am-blod"},[t._v(t._s(i.money))])],1)],1)],2)],1)})),1)],1),e("v-uni-view",{staticClass:"ub"},[e("v-uni-button",{staticClass:"login-dialog-btn ub ub-ac ub-pc",attrs:{type:"default"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.isShow=!1}}},[t._v("取消")]),e("v-uni-button",{staticClass:"login-dialog-btn ub ub-ac ub-pc",attrs:{type:"primary"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.confirmSub()}}},[t._v("提交")])],1)],1)],1):t._e(),e("v-uni-view",{staticClass:"custpro-main search-cont"},[e("v-uni-view",{staticClass:"index-search"},[e("v-uni-view",{staticClass:"index-search-cont"},[e("v-uni-view",{staticClass:"search-input-box",staticStyle:{width:"100%"}},[e("v-uni-input",{staticClass:"index-search-txt",attrs:{"confirm-type":"search",placeholder:"请输入"},on:{confirm:function(i){arguments[0]=i=t.$handleEvent(i),t.toSearch.apply(void 0,arguments)}},model:{value:t.keyTxt,callback:function(i){t.keyTxt=i},expression:"keyTxt"}}),e("v-uni-button",{staticClass:"index-search-btn s-btn",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.toSearch()}}},[t._v("搜索")])],1)],1)],1),t._l(t.proList,(function(i,a){return e("v-uni-view",{staticClass:"custpro-list"},[e("v-uni-view",{staticClass:"goods-info",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toDetail(i)}}},[e("v-uni-image",{staticClass:"custpro-img",attrs:{src:t.$http.imgUrl+i.titlepicurl,mode:"widthFix"}}),e("v-uni-view",{staticClass:"custpro-fr"},[e("v-uni-view",{},[e("v-uni-text",{staticClass:"custpro-title"},[t._v(t._s(i.title))]),e("v-uni-view",[t._v("进价:"),e("v-uni-text",{staticClass:"am-text-danger"},[t._v("￥")]),e("v-uni-text",{staticClass:"index-price"},[t._v(t._s(i.inprice))]),t.$check.isEmpty(i.suitable)?t._e():e("v-uni-view",[t._v("品牌:"+t._s(i.suitable))]),t.$check.isEmpty(i.uqdescription)?t._e():e("v-uni-view",[t._v("规格:"+t._s(i.uqdescription))])],1)],1)],1)],1),e("v-uni-view",{staticClass:"stock-info"},[e("v-uni-view",{staticClass:"stock-item"},t._l(i.stockList,(function(a,s){return e("v-uni-view",{key:s,staticClass:"custpro-cont"},[e("v-uni-view",{staticClass:"custpro-item"},[t._v("库存:"+t._s(a.storage))]),a.storage>0?e("v-uni-view",{staticClass:"custpro-cart"},[e("uni-number-box",{attrs:{min:0,max:a.storage,value:a.boot_qty>=a.storage?a.storage:a.boot_qty,disabled:t.isDisabled,height:24,width:90},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.changeCart(e,s,i.stockList)}}})],1):e("v-uni-view",{staticClass:"custpro-cart"},[a.isCancel?[e("uni-number-box",{attrs:{min:0,value:a.boot_qty,height:24,width:90}}),e("v-uni-view",{staticClass:"booking-btn"},[e("v-uni-button",{attrs:{type:"warn",size:"mini"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.remindCancel(a)}}},[t._v("取消预订")])],1)]:[e("uni-number-box",{attrs:{min:0,value:a.boot_qty,disabled:!0,height:24,width:90}}),e("v-uni-view",{staticClass:"booking-btn"},[e("v-uni-button",{staticStyle:{"background-color":"#CCCCCC"},attrs:{type:"warn",size:"mini"}},[t._v("已取消")])],1)]],2)],1)})),1)],1)],1)}))],2),e("v-uni-view",{staticClass:"cart-bottom custpro-bottom",staticStyle:{bottom:"0"}},[e("v-uni-view",{staticClass:"cart-bottom-cont"},[e("v-uni-view",{staticClass:"cart-bot-left"},[e("v-uni-view",[t._v("总价格："),e("v-uni-text",{staticClass:"cart-price"},[t._v("￥"+t._s(t.totalPrice))])],1),e("v-uni-view",[t._v("总数量："),e("v-uni-text",{staticClass:"cart-price"},[t._v(t._s(t.totalNum))])],1)],1),e("v-uni-button",{staticClass:"cart-bot-right",attrs:{type:"default"},on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.toSumit()}}},[t._v("提交订单")])],1)],1)],1)},o=[];e.d(i,"b",(function(){return s})),e.d(i,"c",(function(){return o})),e.d(i,"a",(function(){return a}))},bc57:function(t,i,e){"use strict";e.r(i);var a=e("96bf"),s=e("fed7");for(var o in s)"default"!==o&&function(t){e.d(i,t,(function(){return s[t]}))}(o);e("91d5");var n,c=e("f0c5"),r=Object(c["a"])(s["default"],a["b"],a["c"],!1,null,"2c00f2d2",null,!1,a["a"],n);i["default"]=r.exports},bf59:function(t,i,e){"use strict";(function(t){var a=e("ee27");e("99af"),e("4160"),e("c975"),e("4e827"),e("b680"),e("e25e"),e("159b"),Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=a(e("7665")),o={components:{uniLoadMore:s.default},data:function(){return{duration:500,proList:[],userInfo:{},custInfo:{},enter:"",note:"",isShow:!1,totalPrice:0,totalNum:0,keyTxt:"",cartItem:[],priview:[],isDisabled:!1}},onLoad:function(){var t=this;uni.getStorage({key:"userInfo",success:function(i){t.userInfo=i.data[0],t.getProduct()}})},methods:{getProduct:function(){var i=this;uni.showLoading(),i.$http.httpTokenRequest({url:i.$api.Remind+"?c_id="+i.userInfo.c_id,method:"GET",data:{}}).then((function(e){t.log(e),uni.hideLoading(),i.proList=e.data.rows;for(var a=0;a<e.data.rows.length;a++)i.$set(i.proList[a],"inprice",0),i.$set(i.proList[a],"zstorage",0),i.$set(i.proList[a],"stockList",[]),i.$set(i.proList[a],"companyName",""),i.$set(i.proList[a],"storemin",0);i.getInPrice(),i.getStoreMinQty()}),(function(i){t.log(i)}))},toDetail:function(t){uni.navigateTo({url:"../detail/detail?code="+t.erpcode+"&type=tobuy"})},getInPrice:function(){var i=this;i.$http.httpTokenRequest({url:i.$api.InPrice+"?c_ma001="+i.userInfo.c_ma001+"&code=",method:"GET",data:{}}).then((function(t){for(var e=0;e<t.data.length;e++)for(var a=0;a<i.proList.length;a++)t.data[e].mb001==i.proList[a].erpcode&&(i.proList[a].inprice=t.data[e].price.toFixed(2));i.getStoreQty()}),(function(i){t.log(i)}))},getStoreQty:function(){var i=this;i.$http.httpTokenRequest({url:i.$api.StoreQty+"?c_id= "+i.userInfo.c_id+"&storage="+i.userInfo.storage+"&code=",method:"GET",data:{}}).then((function(e){t.log("获取库存"),t.log(e.data);for(var a=0;a<i.proList.length;a++)for(var s=0;s<e.data.length;s++)if(e.data[s].mc001==i.proList[a].erpcode){if(0==e.data[s].mc007)var o="预定提醒";else o=e.data[s].storage;if(i.proList[a].item.length<2){if(i.proList[a].item[0].r_mc002.indexOf(e.data[s].mc002)>-1)var n=i.proList[a].item[0].r_qty}else for(var c=0;c<i.proList[a].item.length;c++)if(i.proList[a].item[c].r_mc002==e.data[s].mc002)n=i.proList[a].item[c].r_qty;var r={name:e.data[s].storage,bname:o,storage:e.data[s].mc007,mc002:e.data[s].mc002,mb001:i.proList[a].erpcode,boot_qty:n,isCancel:!0};i.proList[a].stockList.push(r),i.proList[a].zstorage=i.proList[a].zstorage+e.data[s].mc007}t.log("-------------------获取产品列表------------------------"),t.log(i.proList)}),(function(i){t.log(i)}))},getStoreMinQty:function(){var i=this;i.$http.httpTokenRequest({url:i.$api.CustStorage+"?ma002="+i.userInfo.c_ma002+"&level="+i.userInfo.c_level+"&m_id="+i.userInfo.c_m_id,method:"GET",data:{}}).then((function(t){for(var e=0;e<i.proList.length;e++)for(var a=0;a<t.data.length;a++)t.data[a].erpcode==i.proList[e].erpcode&&(i.proList[e].storemin=i.proList[e].storemin+t.data[a].qty)}),(function(i){t.log(i)}))},changeCart:function(i,e,a){var s=this;s.$set(a[e],"s_qty",i),s.totalNum=0,s.totalPrice=0,t.log(s.proList);for(var o=0;o<s.proList.length;o++)for(var n=0;n<s.proList[o].stockList.length;n++)s.$check.isEmpty(s.proList[o].stockList[n].s_qty)||s.proList[o].stockList[n].storage>0&&(s.totalNum=parseInt(s.totalNum)+parseInt(s.proList[o].stockList[n].s_qty),t.log("总数量："+s.proList[o].inprice),s.totalPrice=s.totalPrice+s.proList[o].stockList[n].s_qty*s.proList[o].inprice)},toSumit:function(){var i=this;i.cartItem=[];var e=[];t.log(i.proList);for(var a=0;a<i.proList.length;a++)for(var s=0;s<i.proList[a].stockList.length;s++){var o,n;if(!i.$check.isEmpty(i.proList[a].stockList[s].s_qty))if(0!=i.proList[a].stockList[s].s_qty)(function(){i.proList[a].stockList[s].storage>0&&i.cartItem.push({mc002:i.proList[a].stockList[s].mc002,mb001:i.proList[a].stockList[s].mb001,qty:i.proList[a].stockList[s].s_qty,price:i.proList[a].inprice});var t={erpcode:i.proList[a].erpcode,name:i.proList[a].title,qty:i.proList[a].stockList[s].s_qty,price:i.proList[a].inprice,storageName:i.proList[a].stockList[s].bname,storage:i.proList[a].zstorage};e.push(t);var c=[];e.forEach((function(t){var i={name:t.storageName,list:[]},e={erpcode:t.erpcode,name:t.name,qty:t.qty,price:t.price,storage:t.storage};i.list.push(e),c.push(i)})),o=[],n={},c.forEach((function(t,i){n[t.name]?o.forEach((function(t){t.name===c[i].name&&(t.list=t.list.concat(c[i].list))})):(o.push(t),n[t.name]=!0)})),i.priview=o.sort(i.compare);for(var r=0;r<i.priview.length;r++){i.$set(i.priview[r],"nums",0),i.$set(i.priview[r],"money",0);for(var l=0;l<i.priview[r].list.length;l++)i.priview[r].nums=i.priview[r].nums+parseInt(i.priview[r].list[l].qty),i.priview[r].money=i.priview[r].money+i.priview[r].list[l].qty*i.priview[r].list[l].price}})()}i.cartItem.length>0?i.isShow=!0:uni.showToast({icon:"none",title:"请选择产品",duration:1500})},compare:function(t,i){var e=t.name,a=i.name;return e<a?-1:e>a?1:0},confirmSub:function(){var i=this;uni.showLoading(),i.$http.httpTokenRequest({url:i.$api.OrderNew,method:"POST",data:{c_id:i.userInfo.c_id,c_openid:i.userInfo.c_openid,c_nickname:i.userInfo.c_nickname,c_ma001:i.userInfo.c_ma001,c_ma002:i.userInfo.c_ma002,c_tel:i.userInfo.c_tel,c_address:i.userInfo.c_address,note:i.note,storage:i.userInfo.storage,item:i.cartItem,m_id:i.userInfo.c_m_id}}).then((function(t){uni.hideLoading(),t.data.State&&(uni.showToast({title:"订单提交成功！",duration:1500}),setTimeout((function(){uni.navigateTo({url:"../myorder/myorder"})}),1500))}),(function(i){t.log(i)})),i.isShow=!1},toSearch:function(){var t=this;t.getProduct()},remindCancel:function(i){t.log(i);var e=this;e.$http.httpTokenRequest({url:e.$api.Remind+"?c_id="+e.userInfo.c_id,method:"POST",data:{mb001:i.mb001,mc002:i.mc002}}).then((function(e){t.log(e),e.data.State&&(i.isCancel=!1,uni.showToast({icon:"success",title:"取消成功!",duration:1500}))}),(function(i){t.log(i)}))}}};i.default=o}).call(this,e("5a52")["default"])},ee2b:function(t,i,e){var a=e("24fb");i=a(!1),i.push([t.i,".index-price[data-v-2c00f2d2]{display:inline-block;margin-right:%?10?%}.tobuy-container[data-v-2c00f2d2]{padding-bottom:%?200?%}.custpro-cart[data-v-2c00f2d2]{width:auto;display:-webkit-box;display:-webkit-flex;display:flex}.custpro-cont[data-v-2c00f2d2]{-webkit-box-align:baseline;-webkit-align-items:baseline;align-items:baseline}.custpro-list[data-v-2c00f2d2],.stock-item[data-v-2c00f2d2]{-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column}.stock-item[data-v-2c00f2d2]{-webkit-box-flex:1;-webkit-flex:1;flex:1}.goods-info[data-v-2c00f2d2],.stock-info[data-v-2c00f2d2]{display:-webkit-box;display:-webkit-flex;display:flex}.stock-info[data-v-2c00f2d2]{-webkit-box-align:center;-webkit-align-items:center;align-items:center}.booking-btn[data-v-2c00f2d2]{margin-left:%?30?%}.booking-btn uni-button[data-v-2c00f2d2]{height:24px;line-height:24px;padding:0 .5em;font-size:12px}.custpro-item[data-v-2c00f2d2]{font-size:%?28?%;width:auto}.detail-tr[data-v-2c00f2d2]:first-child{background-color:#eee}.detail-table[data-v-2c00f2d2]{border-left:1px solid #ddd}.detail-td[data-v-2c00f2d2]{-webkit-box-flex:inherit;-webkit-flex:inherit;flex:inherit;width:44%;font-size:%?24?%}.stock-name[data-v-2c00f2d2]{display:block;padding:%?10?% %?20?%;background-color:#6dacf0;font-weight:700}.login-dialog-cont[data-v-2c00f2d2]{top:10%;padding:5% 2%}.scroll-Y[data-v-2c00f2d2]{max-height:%?600?%}",""]),t.exports=i},fed7:function(t,i,e){"use strict";e.r(i);var a=e("bf59"),s=e.n(a);for(var o in a)"default"!==o&&function(t){e.d(i,t,(function(){return a[t]}))}(o);i["default"]=s.a}}]);